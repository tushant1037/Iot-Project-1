# Iot-Project-1
ECG System 

ABSTRACT

An ECG(ElectroCardioGram) is a medical test that detects heart problems by measuring the electrical activity generated by heart. The existing systems are difficult to operate and offer very low portability and are costly as well. The ECG equipment is  also not easily available for personal use. So to overcome all these problem  in existing system we are developing “Portable ECG System Using Smartphone”. This system offers lot of features and makes the patient and doctor’s interaction more easier  and efficient.
The proposed system allows the user  to send the real time waveform to the doctor who is remotely located. In this system we are offering quick request and response mechanism and quick analysis of the ECG pattern for further treatment of patient. This ECG System can also be of great help for the Geriatrics personal use. The Instrument cost is kept low with high portability.  

Contents
  Chapter 1 – Introduction	…………...
Chapter 2 – Background	
2.1– Definition and History of the 12 ECG Leads	
2.2– ECG Physiology	
2.3– Current ECG Technology	
Chapter 3 - Project Objectives and Approach	
Architecture	
ECG Sensor AD8232 Board	
NODEMCU ESP8266 and Server Connectivity	
Mobile Application	









Introduction

An We live at an exciting time in the technology industry. Despite the fact that modern technological devices such as phones, computers, and various peripherals are getting cheaper and smaller, they continue to become more powerful, more accurate, and more portable. Combining these observations with the fact that science is continually discovering new methods for acquiring and processing data, we find that individuals are using today’s smartphone technology to create innovative solutions to issues that would not have been solvable otherwise.
One of the most prominent issues in medical technology today is the cost of medical devices and, more specifically, how much individuals are able to spend on average to purchase life-saving diagnostic equipment. According to the World Health Organization (WHO), developed countries such as the United States spend $290 per head on medical equipment, whereas developing countries such as India only spend  $6 per head on medical equipment.1 Devices such as electrocardiograms (ECG/EKG) are used to measure the electrical activity of the heart and diagnose life-threatening conditions such as myocardial infarctions (MI), or heart attacks. The cost of such devices currently range from about $2,000 and $8,000 for simple units to over $13,000 for portable units that contain defibrillators. These devices have huge costs, it is apparent that there needs to be more affordable alternatives created for the healthcare markets in countries that simply cannot spend that much on medical devices.
Given the current environment of both consumer electronics and medical devices, it was inevitable that an increasing number of corporations and startups would work toward developing low-cost, smartphone-based medical devices. From Bluetooth blood pressure cuffs to watches that measure your blood-oxygen saturation to glucometers that report your blood glucose to your phone, there are new devices which replaces consumer electronics and medicine to improve modern healthcare both in and out of the clinical setting.
ECG Block Diagram
In this project, we aimed to combine our skills in electrical engineering and software engineering with our clinical knowledge of the human cardiovascular system to develop a low-cost, smartphone-based ECG. Figure 1 outlines the basic block diagram of an ECG. The ECG is capable of pairing to any Android smartphone using Bluetooth to allow physicians and other
Background

2.1– Definition and History of the 12 ECG Leads
As was described at the end of the previous section, the ECG follows the electrical activity in the heart. Figure 6 outlines what we observe on an ECG for a normal sinus rhythm, the normal electrical activity in a properly functioning heart. The normal sinus rhythm is broken up into a number of waves, the most prominent are the P, Q, R, S, and T waves. U waves are typically not seen on the ECG. P waves signify atrial depolarization, the QRS complex signifies ventricular depolarization, and the T waves signify ventricular repolarization. Atrial depolarization is hidden behind the QRS complex. As can be seen in the graphic below, in order to get all of the necessary detail for an ECG, the analog system has to be able to detect voltage changes as small as approximately 0.1mV in the Q wave. Each wave on the ECG corresponds to a crucial phase of a heartbeat.


FIGURE 6 - NORMAL SINUS RHYTHM ON AN ECG

When a heart beats, it is broken into a number of specific actions and phases. The action of the myocardium (cardiac muscle) contraction, and subsequently pumping blood out of the contracting chamber, is referred to as depolarization. The P wave is the result of the depolarization of the heart’s atria. The Q, R, and S waves together are referred to as the QRS complex. The QRS complex signifies the depolarization of the heart’s ventricles. The repolarization (or return to rest) of the heart’s atria is hidden behind the electrical activity from the QRS complex. The T wave is the repolarization of the ventricles. As can be seen in the image above, there are a number of different time segments, which can be used by medical professionals to diagnose different conditions of the heart.
In order to generate these potentials through the heart, which lead to the heart’s depolarization and subsequent repolarization, the heart has an electrical system that is shown in detail in Figure 7. The pacemaker of the heart, the Sinoatrial Node (SA node), creates the first electrical stimulus of the heart. This impulse travels through the atria, causing atrial depolarization, ultimately gathering again at the Atrioventricular Node (AV node). From here, the impulse gets sent down the Bundle of His and down the left and right bundle branches. At the bottom of the branches, the impulse is sent to the left and right ventricles. As the impulse passes through the conductive pathways, it causes the depolarization of the ventricles. Meanwhile, as the ventricles are contracting, the atria are repolarizing. After the ventricles contract, they slowly repolarize back to the state of rest.


FIGURE 7 - ELECTRICAL CONDUCTION SYSTEM OF THE HEART
Although the actions of the myocardium tissue described above are what we see in an ECG, there is a significantly greater amount of action occurring at the cellular level that leads to the ECG output. As the electrical impulse from the SA node travels through the heart, it is stimulating the myocardial cells.
What actually happens during this stimulation is the activation of a sodium-potassium pump in the cells. As the myocardial cells conduct and then pass the signal along to adjacent cells, electrically stimulated sodium channels are being opened up. These fast sodium channels take in positive sodium ions (Na+), which surround the cells at rest. Eventually, this rapid influx of positive sodium ions causes the depolarization of the cell to reach a threshold, causing the cellular action and contraction. The cell achieves depolarization because the potassium channels, which expel positive potassium ions (K+) from the cell, are much slower than the sodium channels. This causes the depolarization to be drastically positive until the potassium ions are expelled. This rapid and large change in cellular charge is what creates the change in electrical potential on the ECG output.

Understanding the ECG :
	In general terms, lets look at what an ECG is representing and how we're able to sense it. The ECG is separated into two basic Intervals, the PR Interval and the QT Interval, described below.

PR Interval:
The PR interval is the initial wave generated by an electrical impulse traveling from the right atrium to the left. The right atrium is the first chamber to see an electrical impulse. This electrical impulse causes the chambers to "depolarize". This forces it to contract and drain deoxygenated blood from both the Superior and Inferior vena cava into the right ventricle. 
QT Interval:
The QT Interval is where things get really interesting. The QRS is a complex process that generates the signature "beep" in cardiac monitors. During QRS both ventricles begin to pump. The right ventricle begins to pump deoxygenated blood into the lungs through the left and right pulmonary arteries. The pulmonary arteries are blue in the diagram because they are carrying deoxygenated blood. They are still called arteries because arteries carry blood away the heart. Science, Again! The left ventricle is also beginning to pump freshly oxygenated blood through the aorta and into the rest of the body. After the initial contraction comes the ST segment. The ST segment is fairly quiet electrically as it is the time where the ventricles waiting to be "re-polarized". Finally the T wave becomes present to actively "re-polarize", or relax the ventricles. This relaxation phase resets the ventricles to be filled again by the atriums.

2.3-Currents ECG Technology

ECG technology, although all designed to accomplish the same objective, varies greatly between the hospital environment, the pre-hospital environment, and the home environment. In the hospital environment, there are large, expensive, powerful devices that can be used to get resting measurements and others that are designed for actives measurements, such as those done during a stress test. One example of these modern resting ECG machines is the Philips PageWriter TC70 16-lead ECG. This is a relatively expensive device with an MSRP of $9990, which incorporates a large cart and battery for hospital use. These ECGs allow for additional precordial leads for hospital use so as to diagnose right-side myocardial infarction involvement. Furthermore, they contain very powerful processors for advanced DSP that simply is not practical for use in the smaller, less expensive devices. However, these devices allow for database integration over Wi-Fi so that clinicians can easily access old ECGs. Although typically only 12-lead ECG, the active ECGs for stress tests typically cost more than the resting ECGs.
In the pre-hospital environment, devices tend to get significantly more expensive. Although these devices tend to incorporate a number of additional features such as blood-oxygen saturation, carbon- dioxide concentration, automatic blood pressure monitors, biphasic defibrillators, and pacers, they typically lack the resolution of the hospital-grade equipment. These portable units are built extremely robust to take falls and physical damage in the pre-hospital environment. Despite their lack of accuracy compared to the hospital equipment, they are still accurate enough to provide life-saving differential diagnoses on patients in the field. These portable units typically cost between $10000 and $50000.
In the wireless ECG environment, there are very few options that are available at the moment. There are a number of products currently available that are able to acquire a single-lead ECG and wireless transmit to a device to view, but there are few to none that are able to interface with a smartphone over Bluetooth. The only current example of a company trying to achieve a smartphone-based 12-lead ECG is Nimbleheart Inc. in California. However, none of their proposed products are currently market-ready.
No pricing is presently available to serve as a reference. Despite being in this early state, the company is pursuing a FDA Class II certification for its device. The cost of this certification is expected to be extremely high and will likely exclude the medical device markets in developing countries due to exorbitant cost like most other devices currently 
available.
Chapter 3 - Project Objectives
Architecture
In this project, we aim to create a novel architecture for Smartphone based ECG that is capable of streaming live ECG data to a smartphone with an accuracy that is comparable to that of a modern hospital-grade ECG. In order to do this, there are three major components to the overall architecture which are outlined with their respective interfaces. The first and arguably most important is the ECG analog front end (AFE). This AFE will be responsible for acquiring all ECG signals in the analog realm in real time with tremendous accuracy. The second major part of the architecture is the embedded processor board. This board will be able to read in the analog outputs from the AFE via analog signals at a rate that best preserves the resolution of the acquired lead signals. This board will then have to interface with a smartphone over server rate fast enough to keep the acquired signals real-time. Finally, a smartphone running the ios or android operating system will read in the data received through server and display this data in real time on the phone.

ECG Sensor AD8232 Board
Datasheet of ECG Sensor Module - AD8232:
 This sensor is a cost-effective board used to measure the electrical activity of the heart. This electrical activity can be charted as an ECG or Electrocardiogram and output as an analog
reading. ECGs can be extremely noisy, the AD8232 Single Lead Heart Rate Monitor acts as an
op amp to help obtain a clear signal from the PR and QT Intervals easily.


Block Diagram of AD8232 ECG Sensor
The AD8232 is an integrated signal conditioning block for ECG and other biopotential
measurement applications. It is designed to extract, amplify, and filter small biopotential signals
in the presence of noisy conditions, such as those created by motion or remote electrode
Placement. The AD8232 module breaks out nine connections from the IC that you can solder pins, wires, or other connectors to. SDN, LO+, LO-, OUTPUT, 3.3V, GND provide essential pins for operating this monitor with an Arduino or other development board. Also provided on this board are RA(Right Arm), LA (Left Arm), and RL (Right Leg) pins to attach and use your own custom sensors. Additionally, there is an LED indicator light that will pulsate to the rhythm of a heart beat.
This product is NOT a medical device and is not intended to be used as such or as an
accessory to such nor diagnose or treat any conditions.

Specifications:
1. The AD8232 Single Lead Heart Rate Monitor is a cost-effective board used to
measure the electrical activity of the heart.
2. This electrical activity can be charted as an ECG or Electrocardiogram and output as
an analog reading.
3. ECGs can be extremely noisy, the AD8232 Single Lead Heart Rate Monitor acts as an
op amp to help obtain a clear signal from the PR and QT Intervals easily.
4. The AD8232 is an integrated signal conditioning block for ECG and other
biopotential measurement.
5. It is designed to extract, amplify, and filter small biopotential signals in the presence
of noisy conditions, such as those created by motion or remote electrode placement.
6. The AD8232 Heart Rate Monitor breaks out nine connections from the IC that you
can solder pins, wires, or other connectors to.
7. SDN, LO+, LO-, OUTPUT, 3.3V, GND provide essential pins for operating this
monitor with an Arduino or other development board.
8. Also provided on this board are RA (Right Arm), LA (Left Arm), and RL (Right Leg)
pins to attach and use your own custom sensors.
9. Additionally, there is an LED indicator light that will pulsate to the rhythm of a heart
beat.
10. Biomedical Sensor Pads and Sensor Cable are required to use the heart monitor.

Features :
1.Brand New & High Quality
2.Analog Output
3.Leads-Off Detection
4.Shutdown Pin
5.LED Indicator
6.Operating Voltage: 3.3V
7.3.5mm Jack for Biomedical Pad Connection
8.Rated Temp Range : 0-70 degree
9.Working Temp Range: -40-85 degree
We'll connect five of the nine pins on the board to your Arduino. The five pins you need are labeled GND, 3.3v, OUTPUT, LO-, and LO+.
Board label	Pin function	Arduino connection
GND	Ground	GND
3.3v	3.3v power supply	3.3v
OUTPUT	Output signal	A0
LO-	Leads off defect-	11
LO+	Leads off defect+	10
SDN	Shutdown	Not used

NODEMCU ESP8266

NodeMCU is an open source IoT platform. It includes firmware which runs on the ESP8266 Wi-Fi SoC from Espressif Systems, and hardware which is based on the ESP-12 module. ... It is based on the eLua project, and built on the Espressif Non-OS SDK for ESP8266.


Espressif’s ESP8266EX delivers highly integrated Wi-Fi SoC solution to meet users’ continuous demands for efficient power usage, compact design and reliable performance in the Internet of Things industry. With the complete and self-contained Wi-Fi networking capabilities, ESP8266EX can perform either as a standalone application or as the slave to a host MCU. When ESP8266EX hosts the application, it promptly boots up from the flash. The integrated high speed cache helps to increase the system performance and optimize the system memory. Also, ESP8266EX can be applied to any microcontroller design as a Wi-Fi adaptor through SPI / SDIO or I2C / UART interfaces. ESP8266EX integrates antenna switches, RF balun, power amplifier, low noise receive amplifier, filters and power management modules. The compact design minimizes the PCB size and requires minimal external circuitries. Besides the Wi-Fi functionalities, ESP8266EX also integrates an enhanced version of Tensilica’s L106 Diamond series 32-bit processor and on-chip SRAM. It can be interfaced with external sensors and other devices through the GPIOs. Software Development Kit (SDK) provides sample codes for various applications. Espressif Systems’ Smart Connectivity Platform (ESCP) enables sophisticated features including fast switch between sleep and wakeup mode for energy-efficient purpose, adaptive radio biasing for low-power operation, advance signal processing, spur cancellation and radio co-existence mechanisms for common cellular, Bluetooth, DDR, LVDS, LCD interference mitigation. 
Specifications:
1.WIFI:
Certification	Wi-Fi Alliance 
Protocols 	802.11 b/g/n 
Frequency Range 			2.4G ~ 2.5G (2400M ~ 2483.5M)

Tx Power 			
	802.11 b: +20 dBm 
802.11 g: +17 dBm
              802.11 n: +14 dBm

Rx Sensitivity 		
	802.11 b: –91 dbm (11 Mbps)
             802.11 g: –75 dbm (54 Mbps) 
             802.11 n: –72 dbm (MCS7)
  2.Hardware
CPU 						Tensilica L106 32-bit processor
Peripheral Interface 		UART/SDIO/SPI/I2C/I2S/IR Remote Control
PIO/ADC/PWM/LED Light & Button
Operating Voltage 				2.5V ~ 3.6V 
Operating Current 				Average value: 80 mA 
Operating Temperature Range 		–40°C ~ 125°C 

Storage Temperature Range	
	 –40°C ~ 125°C 

             3.Software: 

Wi-Fi Mode	Station/SoftAP/SoftAP+Stationm
Security	WPA/WPA2
Encryption	WEP/TKIP/AES
Firmware Upgrade	UART Download/OTA(via network)
Software Development	Supports Cloud Server Development/Firmware and SDK for fast on-chip programming
Network Protocols	IPv4,TCp/UDP/HTTP/FTp
User Configuration	AT Instruction Set,Cloud Server,Android iOS App

Features:
1.11 b/g/n Wi-Fi Direct (P2P), soft-AP
2.Integrated TCP/IP protocol stack
3.Use CH340G replace the CP2102.
4.Open-source, Interactive, Programmable, Low cost, Simple, Smart, WI-FI enabled
5.Arduino-like hardware IO
6.Integrated low power 32-bit CPU
7.Advanced API for hardware IO, which can dramatically reduce the redundant work for configuring and manipulating hardware.
8.Code like Arduino, but interactively in Lua script.
9.Nodejs style network API
10.Event-driven API for network applications,
11.which facilitates developers writing code running on a 5mm*5mm sized MCU in Nodejs style.
12.Greatly speed up your IOT application developing process.
13.Lowest cost WIFI
14.Less than WIFI MCU ESP8266 integrated and easy to prototyping development kit.
15.We provide the best platform for IoT application development at the lowest cost.
16.Integrated TR switch, balun, LNA, power amplifier and matching network
17.Integrated PLL, regulators, DCXO and power management units
18.Onboard USB to serial chip to easily program and upload codes from the Arduino IDE
19.Embeds logic level converter circuits
20.Has onboard 3.3V regulator to ensure enough power to function as your go-to WiFi chip!
21.Easy access to the GPIO pins for easy prototyping
22.ESP-12E Processor
23.Easy to use breadboard friendly form factor
24.Voltage Regulator / Converter, excellent DC to DC conversion, super efficient

Firebase Connectivity with NODEMCU

    Store and sync data with our NoSQL cloud database. Data is synced across all clients in realtime, and remains available when your app goes offline.
The Firebase Realtime Database is a cloud-hosted database. Data is stored as JSON and synchronized in realtime to every connected client. When you build cross-platform apps with our iOS, Android, and JavaScript SDKs, all of your clients share one Realtime Database instance and automatically receive updates with the newest data.
Key capabilities
1.Realtime:
Instead of typical HTTP requests, the Firebase Realtime Database uses data synchronization—every time data changes, any connected device receives that update within milliseconds. Provide collaborative and immersive experiences without thinking about networking code.
2.Offline:
Firebase apps remain responsive even when offline because the Firebase Realtime Database SDK persists your data to disk. Once connectivity is reestablished, the client device receives any changes it missed, synchronizing it with the current server state.
3.accessable from client devices:
The Firebase Realtime Database can be accessed directly from a mobile device or web browser; there’s no need for an application server. Security and data validation are available through the Firebase Realtime Database Security Rules, expression-based rules that are executed when data is read or written.
4.scale across from multiple databases: 
With Firebase Realtime Database on the Blaze pricing plan, you can support your app's data needs at scale by splitting your data across multiple database instances in the same Firebase project. Streamline authentication with Firebase Authentication on your project and authenticate users across your database instances. Control access to the data in each database with custom Firebase Realtime Database Rules for each database instance.

We need Arduino IDE, Nodemcu hardware, wifi connection to the process of connectivity of server to hardware.
What is Arduino IDE? 
    Arduino IDE is IDE which is very useful to write code for hardware devices. Mainly it is use for arduino devices but if we want to write code for some other devices then we have to install first the library for giver hardware then we can write code for it. Basically arduino ide use the language is embeded c. Default language of arduino is lua scripting but mostly programmers use embeded c to write code for hardware. It is very similar to c language. Arduino ide contain serial plotter which plot the graph of hardware data. 
How to use Arduino IDE for NODEMCU ?
    Firstly we have to write code on arduino ide. And then there is button on screen to send code to hardware we have to click it to send code to hardware. Before that we have to connect the hardware to laptop or desktop using usb cable. We have to check that we insert cable to correct port else change the port of usb. After sending the code , if there is no error then it compile successfully else it shows error. If we compile code successfully then the hardware work according to code.

To connect firebase realtime database to hardware(NODEMCU), we need a establishment of wifi connection to hardware. When hardware connect to wifi connection then we have to add following information about our server to connect it to server.

#include <ESP8266WiFi.h>;
#include <FirebaseArduino.h>                                         // firebase library
#define FIREBASE_HOST "meio.com"  // the project name address id
#define FIREBASE_AUTH "KJqL90usfs4ybMFB"                         // the secret key generated from firebase
#define WIFI_SSID "nearToEnd"                                    // input your home or public wifi name 
#define WIFI_PASSWORD "1234567877"

1st line contain the esp8266 library which is used to write code for nodemcu. 2nd line contaion the firebase database connectivity library. Next two lines contaion the project details. Hosting and authntication of server. And next two lines are for wifi connectivity.


Mobile Application
We have writing an application for these IOT project using Flutter which is native application development platform.
What is Flutter?
Flutter is native application development platform which uses the language dart. Flutter is developed by google company. Flutter is competitor of react native which is developed by facebook but their are some limitations of react native, we will descuss it later.
Why Flutter ?
Flutter is latest technology to develop mobile applications. React native need to write different code for android and ios but flutter can run on both platform with same codebase. Thats why flutter is better than react native. Flutter reduces time as well as cost.
Google developed a ML kit for Flutter development which is very compatible with frebase realtime database thats why we are using flutter to develop an application.


































